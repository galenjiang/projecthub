var app=new Vue({mixins:[Mui.vueMixinInit],components:{"mui-switch":Mui["switch"]},el:"#app",data:{name:"",mobile:"",permoney:0,people:1,discount:"",switchStatus:!0,radio:1,activityInfo:{},id:null},computed:{leftScore:function(){return this.userdata.integral-this.discount},dismoney:function(){return(this.discount*this.radio).toFixed(2)},shouldpay:function(){return this.permoney||(this.permoney=0),this.people||(this.people=0),this.permoney||(this.permoney=0),this.discount||(this.discount=0),this.radio||(this.radio=0),(this.permoney*parseInt(this.people)-parseFloat(this.discount)*parseFloat(this.radio)).toFixed(2)}},methods:{init:function(){this.getRadio(),this.getActivityInfo(),this.updateUserInfo()["catch"](function(t){alert(t)})},disSwitch:function(t){t||(this.discount=""),this.switchStatus=t},getRadio:function(){Vue.http.get(url+"index.php?m=Api&c=Mall&a=mallIntegralRule",{}).then(function(t){util.console.log(t.data),1==t.data.status?this.radio=t.data.data:Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(t)})},getActivityInfo:function(){Vue.http.get(url+"index.php?m=Api&c=Active&a=booking_active",{mall_id:this.userdata.current_mall_id,id:this.id}).then(function(t){1==t.data.status?(util.console.log(t.data.data),this.activityInfo=_.mapValues(t.data.data,function(t){return t}),this.permoney=t.data.data.can_pay_many):Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(t)})},join:function(){if(this.leftScore<0)return Mui.message.toast({msg:"积分不足"}),!1;if(this.shouldpay<0)return Mui.message.toast({msg:"积分抵扣超出需要的金额"}),!1;var t={};_.forEach(this.activityInfo.countent,function(i){t[i.id]=i.value}),util.console.log(this.activityInfo.countent),Vue.http.get(url+"index.php?m=Api&c=Active&a=repeat_booking",{mall_id:this.userdata.current_mall_id,active_id:this.id,content:t,discout_integral:this.discount,repeat_people:this.people}).then(function(t){if(util.console.log(t.data),0==t.data.status)Mui.message.toast({msg:t.data.info});else if(1==t.data.status)window.location.href=url+"index.php?m=Home&c=Activity&a=activity_payment_success";else{if("object"!=typeof t.data)throw new Error("系统错误");wechat.pay(t.data,function(t){"get_brand_wcpay_request:ok"==t.err_msg?window.location.href=url+"index.php?m=Home&c=Activity&a=activity_payment_success":"get_brand_wcpay_request：cancel"==t.err_msg||Mui.message.toast({msg:"支付失败,请稍后再试"})})}}.bind(this))["catch"](function(t){alert(t)})}},created:function(){var t=util.urlQuery();this.id=t.id}});