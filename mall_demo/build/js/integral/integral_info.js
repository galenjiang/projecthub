var app=new Vue({mixins:[Mui.vueMixinInit],el:"#integralInfo",data:{userdata:{},id:0,limit:!0,mall:null,infodata:{},commentdata:{},payShow:!1,count:1,shareMaskStatus:!1},methods:{init:function(){this.getGiftInfo(),this.updateUserInfo()["catch"](function(t){alert(t)})},getGiftInfo:function(){Vue.http.get(url+"index.php?m=Api&c=IntegralGift&a=getoneGift",{id:this.id,limit:this.limit}).then(function(t){1==t.data.status?(util.console.log(t.data.data),this.infodata=_.mapValues(t.data.data.oneGift,function(t,a){return"img"==a&&(t=url+t),t}),this.commentdata=_.map(t.data.data.comment.list,function(t,a){return"img"==a&&(t=_.map(t,function(t){return t=url+t})),t})):Mui.message.toast({msg:t.data.info}),this.shareInit()}.bind(this))["catch"](function(t){alert(t)})},openPay:function(){this.payShow=!0,event.preventDefault()},closePay:function(){this.payShow=!1,event.preventDefault()},minus:function(){this.count<=1?Mui.message.toast({msg:"数量不能低于1件"}):this.count-=1},plus:function(){this.count+=1},pay:function(){Vue.http.get(url+"index.php?m=Api&c=IntegralGift&a=commit_order",{mall_id:this.mall||this.userdata.current_mall_id,order_number:this.count,gift_id:this.id,gift_name:this.infodata.name,type:1==this.limit?1:2}).then(function(t){if(0==t.data.status)Mui.message.toast({msg:t.data.info});else if(1==t.data.status)window.location.href=url+"index.php?m=Home&c=Integral&a=integral_change_success";else{if("object"!=typeof t.data)throw new Error("系统错误");wechat.pay(t.data,function(t){"get_brand_wcpay_request:ok"==t.err_msg?window.location.href=url+"index.php?m=Home&c=Integral&a=integral_change_success":"get_brand_wcpay_request：cancel"==t.err_msg||Mui.message.toast({msg:t.err_msg})})}}.bind(this))["catch"](function(t){alert(t)})},shareInit:function(){var t={title:"乐坊商场",desc:this.infodata.name,link:window.location.href+"&mall="+this.mall||this.userdata.current_mall_id,imgUrl:this.infodata.img,success:function(){Mui.message.toast({msg:"分享成功"})},cancel:function(){Mui.message.toast({msg:"系统错误"})}};wx.onMenuShareAppMessage(t),wx.onMenuShareTimeline(t)},share:function(){this.shareMaskStatus?this.shareMaskStatus=!1:this.shareMaskStatus=!0,event.preventDefault()}},created:function(){var t=util.urlQuery();this.id=t.id,this.mall=t.mall,this.limit=t.limit}});