var app=new Vue({mixins:[Mui.vueMixinInit],components:{"mui-upload-picture":Mui.uploadPicture},el:"#app",data:{userdata:{},shopList:[],sendObj:{mall_id:"",receipt_id:"",receipt_amount:"",shop_id:"",consume_time:(new Date).Format("yyyy-MM-dd"),receipt_img:[]},imgArr:[],imgList:1},events:{img:function(t){util.console.log(this.sendObj.receipt_img);var i=_.findIndex(this.imgArr,function(i){return i.index==t.index});if(util.console.log(i),-1!=i){var e=_.slice(this.imgArr);e[i]=t}else this.imgArr=_.concat(this.imgArr,t);this.sendObj.receipt_img=_.map(this.imgArr,function(t){return t.img})},close:function(t){var i=_.slice(this.imgArr);this.imgArr=_.filter(i,function(i){return i.index!=t}),this.sendObj.receipt_img=_.map(this.imgArr,function(t){return t.img})}},methods:{init:function(){this.sendObj.mall_id=this.userdata.current_mall_id,this.getShopList()},add:function(){this.imgList+=1,event.preventDefault()},getShopList:function(){Vue.http.get(url+"index.php?m=Api&c=Shop&a=shop_all_list",{mall_id:this.userdata.current_mall_id}).then(function(t){1==t.data.status?this.shopList=_.map(t.data.data,function(t){return t}):Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(t)})},sendTicketInfo:function(){/.+/.test(this.sendObj.receipt_id)?/.+/.test(this.sendObj.receipt_amount)?/.+/.test(this.sendObj.shop_id)?/.+/.test(this.sendObj.consume_time)?/.+/.test(this.sendObj.receipt_img)?(Vue.http.options.emulateJSON=!0,Vue.http.post(url+"index.php?m=Api&c=UserCard&a=inputReceipt",this.sendObj).then(function(t){1==t.data.status?Mui.message.alert({msg:"录入成功,请等候审核！"},function(){window.location.href=url+"index.php?m=Home&c=User&a=membercard_selfhelp"}):Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(err)})):Mui.message.toast({msg:"请上传小票照片！"}):Mui.message.toast({msg:"请输入消费时间！"}):Mui.message.toast({msg:"请填写消费店铺！"}):Mui.message.toast({msg:"请填写小票金额！"}):Mui.message.toast({msg:"请填写小票号码！"})}}});