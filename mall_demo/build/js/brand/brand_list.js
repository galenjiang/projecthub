var app=new Vue({mixins:[Mui.vueMixinInit],components:{"mui-screen":Mui.screen,"mui-show-pic":Mui.showPiture},el:"#app",data:{userdata:{},screenList:[{name:"楼层"},{name:"分类"},{name:"排序"}],cur:-1,floorList:[],catalogList:[],shopList:[],totalpage:1,page:1,floor:"",category:"",sort:"",allowrefresh:!0},methods:{init:function(){this.getFloorList(),this.getCateList(),this.getShopList()},getCateList:function(){Vue.http.get(url+"index.php?m=Api&c=Mall&a=category",{mall_id:this.userdata.current_mall_id}).then(function(t){util.console.log(t.data),1==t.data.status?this.catalogList=_.map(t.data.data,function(t){return{id:t.id,name:t.name,logo_pic:url+t.logo_pic}}):Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(t)})},getFloorList:function(){Vue.http.get(url+"index.php?m=Api&c=Mall&a=floorList",{mall_id:this.userdata.current_mall_id}).then(function(t){1==t.data.status?this.floorList=t.data.data:Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){alert(t)})},floorSearch:function(t){this.shopList=[],this.floor=t,this.page=1,this.totalpage=1,this.getShopList(),this.collapseMenu(),event.preventDefault()},cateSearch:function(t){this.shopList=[],this.category=t,this.page=1,this.totalpage=1,this.getShopList(),this.collapseMenu(),event.preventDefault()},sortSearch:function(t){this.shopList=[],this.sort=t,this.page=1,this.totalpage=1,this.getShopList(),this.collapseMenu(),event.preventDefault()},getShopList:function(){this.allowrefresh&&this.page<=this.totalpage&&(this.allowrefresh=!1,Vue.http.get(url+"index.php?m=Api&c=Shop&a=shop_list",{mall_id:this.userdata.current_mall_id,floor:this.floor,category:this.category,sort:this.sort,page:this.page}).then(function(t){if(this.allowrefresh=!0,1==t.data.status){this.page+=1,this.totalpage=t.data.data.totalpage;var a=_.map(t.data.data.list,function(t,a){return{url:url+"index.php?m=Home&c=Brand&a=brand_detail&id="+t.id,img:url+t.image,textUpper:t.name,textLower:"L"+t.floor+" "+t.house_number}});this.shopList=_.concat(this.shopList,a),util.console.log(t.data.data,this.data)}else Mui.message.toast({msg:t.data.info})}.bind(this))["catch"](function(t){this.allowrefresh=!0,alert(t)}.bind(this)))},collapseMenu:function(){var t=Array.prototype.slice.call(this.$el.querySelectorAll(".mui-screen-item"));_.forEach(t,function(t){t.classList.remove("show")}),this.cur=-1}}});